<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard maanlander</title>
    <link rel="stylesheet" href="stylesheet.css">
    <script src="/scripts/dataScripts.js"></script>
</head>

<body>
    <img src="images/AASA_logo.png" alt="logo1" width="200" height="200" class="center">

    <!--Navbar-->
    <div style="width: 100%;">
        <ul id="navbar">
            <li id="hornav"><a href="default.asp"></a>test</li>
            <li id="hornav"><a href="accounts.asp"></a>accounts</li>
        </ul>
    </div>

    <div id="errors">
    </div>
    <div id="controls" style="justify-content: center;">
        <button type="button" onclick="ledOn()">led aan</button>
        <button type="button" onclick="ledOff()">led uit</button>

    </div>

    <i id="unixtime">Unixtime output</i>

    <script>
        //Web socket script. Should look into putting this in a script file. Need this to open upon website loading
        const saturl = '145.49.111.54:1880';       //Url used in all API and websocket requests to connect to satellite
        const groupId = 'groep19';                 //Specific group it wants to connect to

        // WebSocket instance
        const socket = new WebSocket('ws//'+saturl+'/ws/'+groupId);

        //On connection/opening of socket
        socket.onopen = () => {
            console.log("WebSocket verbonden met satelliet");
        };

        //On receiving message/JSON from server
        socket.onmessage = (event) => {
            console.log("Ontvangen WebSocket data:", event.data);

            //receives JSON and parses it into readable data
            try {
                const satData = JSON.parse(event.data);
              
                //shows unixtime
                if (!isNaN(unixtime)) {
                    document.getElementById("unixtime").textContent =
                        "Arduino leeftijd: " + satData.unixtime_1;
                } else {
                    document.getElementById("unixtime").textCont =
                        "Fout: geen geldige unixtime ontvangen";
                    document.getElementById("unixtime").textContent =
                        "Geen data ontvangen";
                }
            } catch (e) {
                console.error("Fout bij verwerken WebSocket data:", e);
            }
        };

        //Handles errors
        socket.onerror = (error) => {
            console.error("WebSocket fout:", error);
            document.getElementById("unixtime").textContent = "WebSocket fout bij ontvangen unixtime.";
        };

        await socket.close(code=1000, reason=None)
    </script>



</body>

</html>